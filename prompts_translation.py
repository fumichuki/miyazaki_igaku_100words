"""
翻訳用プロンプトテンプレート - 宮崎大学医学部
和文英訳（段落単位）の問題生成・添削用
"""

# 7ジャンル定義（themeの固定語）
TRANSLATION_GENRES = [
    "研究紹介",  # Research summary
    "時事",      # News / whistleblowing
    "学術",      # Academic exposition
    "ブログ",    # Casual blog post
    "レビュー",  # Review
    "コラム",    # Op-ed / short argument
    "図表",      # Graph / data description
]

# 過去問例（段落分け済み）※スタイル参照用
PAST_QUESTIONS_REFERENCE = """
【2025 研究紹介】段落例
P1: ある研究によると、右手を握りしめることで記憶が良くなり、左手を握りしめることで思い出す能力が高まることが明らかになった。
P2: 参加者は4つのグループに分けられ、まず72語のリストを記憶し、その後で思い出すという課題を行った。
P3: 1つのグループは右手を握りしめて記憶した。別のグループは左手を握りしめて記憶した。残り2つのグループは左右を入れ替えた。
P4: その結果、記憶時に右手・想起時に左手を握りしめたグループが最も良い成績を収めた。

【2024 時事】段落例
P1: 2009年から2013年までNSAに勤務していたSnowdenが、監視活動の情報を密かに収集していた。
P2: Verizonを経由した通話記録の収集を発見し、これを暴露した。
P3: PRISMというプログラムが、大手IT企業9社へ直接アクセスできる仕組みを持っている可能性がある。
P4: 彼を裏切り者と見る人もいれば、英雄と見る人もおり、意見が対立している。

【2023 学術】段落例
P1: 日記をつけることの精神的・感情的効果はデータで実証されており、専門家も勧めている。
P2: 15〜20分の記録を3〜5回続けることで、トラウマやストレスと折り合いをつけられた人もいる。
P3: がんなどの深刻な病気を抱える人には特に効果があり、専門的な療法として確立されている。

【2022 ブログ】段落例
P1: 待ち時間にスマホを確認するのが習慣になっていたが、次々とタスクが連鎖して増えてしまうので、この習慣を減らしたいと思っていた。
P2: 待ち時間にプチ体操（ストレッチ、足首回し、肩回しなど）を試したところ、無理なく続けられている。
P3: スマホを見る時間が減り、首や目の疲れも軽減された。忙しい人にも試す価値があると思う。

【2021 レビュー】段落例
P1: 主人公ジョンの仕事は、孤独死した人の身元を調査し、葬儀を執り行うことだった。
P2: 彼の丁寧な仕事ぶりに胸を打たれた。主人公の表情が心地よかった。
P3: 人と向き合う難しさや大切さを描いたヒューマンドラマで、印象的なラストシーンがある。
P4: 荒んだ心を浄化してくれるような作品で、人を許すことを教えてくれる気がした。
"""

# 問題生成用プロンプト（翻訳形式）
QUESTION_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の出題専門家です。

# 宮崎大学医学部の和文英訳問題の特徴
- 日本語の段落（2〜4段落）を英語に訳す形式
- 全体で100-120語程度の英訳になる和文量
- 7つのジャンル（研究紹介・時事・学術・ブログ・レビュー・コラム・図表）から出題
- 段落ごとに構造的なまとまりがある
- 翻訳の正確性・自然さ・文法が評価される

# 出題条件
- 避けるテーマ: {excluded_themes}
- 今回のジャンル候補: 研究紹介、時事、学術、ブログ、レビュー、コラム、図表

# 7ジャンルごとの段落構造テンプレート

①研究紹介（Research summary）:
  P1: 主張/仮説の提示
  P2: 研究方法・手順
  P3: 実験条件/グループ分け
  P4: 結果・発見

②時事（News / whistleblowing）:
  P1: 背景・人物紹介
  P2: 発見・暴露の内容
  P3: 詳細・具体的事実
  P4: 賛否・影響・反応

③学術（Academic exposition）:
  P1: 一般論＋研究による根拠
  P2: 具体的な研究報告
  P3: 効果・適用範囲

④ブログ（Casual blog post）:
  P1: 最近の悩み・課題
  P2: 試した工夫・方法
  P3: 感想・効果＋提案

⑤レビュー（Review）:
  P1: 導入・あらすじ紹介
  P2: 評価ポイント
  P3: テーマ性・印象的シーン
  P4: おすすめ・余韻

⑥コラム（Op-ed / short argument）:
  P1: 問題提起
  P2: 主張＋理由
  P3: 譲歩/反論想定
  P4: 提案・まとめ

⑦図表（Graph / data description）:
  P1: 表/グラフ/数値の提示
  P2: 主な増減・比較
  P3: 理由の推測
  P4: まとめ・結論

# 過去問スタイル参照（※同じ内容での再生成は禁止）
{past_questions_reference}

# 出題要件【必須】

1. **themeの選択**
   - 7ジャンルの固定語（研究紹介/時事/学術/ブログ/レビュー/コラム/図表）から1つ選ぶ
   - excluded_themes に含まれるジャンルは避ける
   - theme は必ず上記7つのいずれかの固定語（括弧付きや細目は追加しない）

2. **japanese_sentences（段落リスト）**
   - 配列で2〜4段落を返す
   - 各段落は2〜3文程度（合計6〜9文が目安）
   - 英訳すると100-120語程度になる和文量
   - 各段落は構造的なまとまりを持つ（上記テンプレートに沿う）
   - 図表ジャンルの場合、表は段落を分けて記述:
     例: P1=表の説明、P2=高校生データ、P3=大学生データ、P4=考察

3. **hints（重要語ヒント）**
   - 5個前後（3〜10個）
   - 本文に出る重要語・専門用語・訳の分岐が大きい語を優先
   - 各ヒントは以下の形式:
     * en: 英語（単語or短い語句）
     * ja: 日本語訳（自然で具体的）
     * kana: カナ発音（任意、学習効果向上のため推奨）
     * pos: 品詞（任意: 名詞/動詞/形容詞/副詞など）
     * usage: 用法（任意: 動詞ならSVO、名詞なら可算/不可算など）
   - 例:
     * {{\"en\": \"surveillance\", \"ja\": \"監視\", \"kana\": \"サーベイランス\", \"pos\": \"名詞\", \"usage\": \"不可算\"}}
     * {{\"en\": \"come to terms with\", \"ja\": \"〜と折り合いをつける\", \"kana\": \"カム・トゥ・ターム\u30ba・ウィズ\", \"pos\": \"動詞句\", \"usage\": \"SVO\"}}

4. **target_words**
   - {{"min": 100, "max": 120}}（固定）

5. **question_text**
   - null または ""（翻訳問題では英語の問いかけ文は不要）

6. **単語の多様性**
   - 毎回新しい語彙・表現を選択
   - ジャンル特有の専門的・具体的な語彙を優先
   - 同じパターンを使い回さない

7. **出力形式**
   - JSON のみで返す
   - コードブロック（```json）は使わない
   - Markdown 記号は使わない
   - 日本語の引用符「」『』は使わない

# 出力JSON形式

{{
  \"theme\": \"研究紹介\",
  \"question_text\": null,
  \"japanese_sentences\": [
    \"（段落1の日本語2〜3文）\",
    \"（段落2の日本語2〜3文）\",
    \"（段落3の日本語2〜3文）\"
  ],
  \"hints\": [
    {{\"en\": \"...\", \"ja\": \"...\", \"kana\": \"...\", \"pos\": \"...\", \"usage\": \"...\"}},
    {{\"en\": \"...\", \"ja\": \"...\", \"kana\": \"...\", \"pos\": \"...\", \"usage\": \"...\"}}
  ],
  \"target_words\": {{\"min\": 100, \"max\": 120}}
}}

# 注意事項
- 過去問の丸写しは禁止（構造と文体のみ模倣）
- 固有名詞や具体的内容は毎回変更
- ジャンルの構造テンプレートに忠実に従う
- 翻訳難易度は中級（高校〜大学受験レベル）
"""

# 添削用プロンプト（翻訳形式）
CORRECTION_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の添削専門家です。

🚨🚨🚨【JSON出力の絶対ルール】🚨🚨🚨
1. **日本語の引用符「」『』は絶対に使わない** → 代わりに () を使う
2. **例文では半角引用符 " " を使うが、必ずエスケープする** → \\"
3. **JSON内で改行する場合は \\n を使う**
4. **reasonフィールド内では、例文を書く場合は必ず半角スペースで区切る**

❌ NG例（JSON構文エラーになる）:
"reason": "例：This is important.「これは重要です。」"

✅ OK例（正しいJSON）:
"reason": "例：This is important. (これは重要です。)"

# 問題形式
宮崎大学医学部の和文英訳問題（100-120語目安）
- 日本語の段落を英語に翻訳
- 翻訳の正確性・自然さ・文法が評価される

# 原文（日本語）
{question_text}

# 学生の英訳（語数：{word_count}語）
{user_answer}

# 添削方針【重要】

## 評価の重点
1. **原文忠実性**: 意味の欠落・追加・誤解がないか
2. **自然さ**: 不自然な直訳、語法の誤りがないか
3. **文法・語彙**: 時制、受動態、関係詞、前置詞、冠詞など

## よくある誤り（指摘に含める）
- 時制の不一致（過去/現在/完了）
- 受動態の不適切な使用
- 関係詞の誤用・省略
- 抽象名詞・名詞化の未使用
- 比較表現の誤り
- 推量表現の不足
- 接続詞（however, therefore など）の不適切な使用
- 直訳による不自然な表現

## 模範解答(corrected)の要件
- 自然で正確な英訳（100-120語目安）
- 段落構造を維持
- 翻訳として理想的な表現を示す
- 必ず語数をカウントして100-120語に収める

## 指摘ポイント(points)の要件
- **最低5個**の具体的な指摘
- 不足時は「より良い表現」の提案で埋める
- 各pointは以下の形式:
  * reason: 指摘理由（具体的に、例文付き）
  * severity: "major"（重大）/ "minor"（軽微）
  * category: "grammar"（文法）/ "vocabulary"（語彙）/ "style"（文体）/ "accuracy"（正確性）

# 出力JSON形式

{{
  \"corrected\": \"（模範英訳、100-120語）\",
  \"overall_comment\": \"（全体的な講評、翻訳の質・改善点）\",
  \"points\": [
    {{
      \"reason\": \"時制の誤り。過去の出来事なので過去形にすべき。例: \\\"found\\\" → \\\"revealed\\\" (明らかにした)\",
      \"severity\": \"major\",
      \"category\": \"grammar\"
    }},
    {{
      \"reason\": \"直訳的で不自然。名詞化すると自然。例: \\\"when we do something\\\" → \\\"in doing something\\\"\",
      \"severity\": \"minor\",
      \"category\": \"style\"
    }}
  ],
  \"word_count\": {word_count},
  \"constraint_checks\": {{
    \"word_count_ok\": true,
    \"has_clear_structure\": true,
    \"appropriate_vocabulary\": true
  }}
}}

# 注意事項
- 「2理由」「First/Second」などの構成は要求しない（翻訳問題のため）
- 翻訳の正確性と自然さを最優先
- points は必ず5個以上
- JSON構文エラーを起こさないよう、引用符のエスケープを厳守
"""

# モデル解答生成用プロンプト（翻訳形式）
MODEL_ANSWER_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の模範解答作成専門家です。

# 原文（日本語）
{question_text}

# 要件
1. **model_answer**: 自然で正確な英訳（100-120語目安）
   - 段落構造を維持
   - 翻訳として理想的な表現
   - 必ず100-120語に収める

2. **model_answer_explanation**: 各文ごとに解説
   - 重要語の選び方
   - 直訳を避けた工夫
   - 構文（受動/関係/分詞/名詞化/比較/推量）の説明
   - 段落ごとに改行して見やすく

# 出力JSON形式

{{
  \"model_answer\": \"（模範英訳、100-120語）\",
  \"model_answer_explanation\": \"【段落1の解説】\\n- 文1: ここでは過去完了を使って...\\n- 文2: 名詞化して簡潔に...\\n\\n【段落2の解説】\\n- 文1: 受動態で客観性を出し...\\n- 文2: 関係詞で情報を追加...\"
}}

# 注意事項
- JSON のみで返す
- コードブロック禁止
- Markdown 記号禁止
- 日本語の引用符「」『』は使わない
- 引用符のエスケープを厳守
"""
