"""
翻訳用プロンプトテンプレート - 宮崎大学医学部
和文英訳（段落単位）の問題生成・添削用
"""

# 7ジャンル定義（themeの固定語）
TRANSLATION_GENRES = [
    "研究紹介",  # Research summary
    "時事",      # News / whistleblowing
    "学術",      # Academic exposition
    "ブログ",    # Casual blog post
    "レビュー",  # Review
    "コラム",    # Op-ed / short argument
    "図表",      # Graph / data description
]

# 過去問例（段落分け済み）※スタイル参照用
PAST_QUESTIONS_REFERENCE = """
【2025 研究紹介】段落例
P1: ある研究によると、右手を握りしめることで記憶が良くなり、左手を握りしめることで思い出す能力が高まることが明らかになった。
P2: 参加者は4つのグループに分けられ、まず72語のリストを記憶し、その後で思い出すという課題を行った。
P3: 1つのグループは右手を握りしめて記憶した。別のグループは左手を握りしめて記憶した。残り2つのグループは左右を入れ替えた。
P4: その結果、記憶時に右手・想起時に左手を握りしめたグループが最も良い成績を収めた。

【2024 時事】段落例
P1: 2009年から2013年までNSAに勤務していたSnowdenが、監視活動の情報を密かに収集していた。
P2: Verizonを経由した通話記録の収集を発見し、これを暴露した。
P3: PRISMというプログラムが、大手IT企業9社へ直接アクセスできる仕組みを持っている可能性がある。
P4: 彼を裏切り者と見る人もいれば、英雄と見る人もおり、意見が対立している。

【2023 学術】段落例
P1: 日記をつけることの精神的・感情的効果はデータで実証されており、専門家も勧めている。
P2: 15〜20分の記録を3〜5回続けることで、トラウマやストレスと折り合いをつけられた人もいる。
P3: がんなどの深刻な病気を抱える人には特に効果があり、専門的な療法として確立されている。

【2022 ブログ】段落例
P1: 待ち時間にスマホを確認するのが習慣になっていたが、次々とタスクが連鎖して増えてしまうので、この習慣を減らしたいと思っていた。
P2: 待ち時間にプチ体操（ストレッチ、足首回し、肩回しなど）を試したところ、無理なく続けられている。
P3: スマホを見る時間が減り、首や目の疲れも軽減された。忙しい人にも試す価値があると思う。

【2021 レビュー】段落例
P1: 主人公ジョンの仕事は、孤独死した人の身元を調査し、葬儀を執り行うことだった。
P2: 彼の丁寧な仕事ぶりに胸を打たれた。主人公の表情が心地よかった。
P3: 人と向き合う難しさや大切さを描いたヒューマンドラマで、印象的なラストシーンがある。
P4: 荒んだ心を浄化してくれるような作品で、人を許すことを教えてくれる気がした。
"""

# 問題生成用プロンプト（翻訳形式）
QUESTION_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の出題専門家です。

# 宮崎大学医学部の和文英訳問題の特徴
- 日本語の段落（2〜4段落）を英語に訳す形式
- 全体で100-120語程度の英訳になる和文量
- 7つのジャンル（研究紹介・時事・学術・ブログ・レビュー・コラム・図表）から出題
- 段落ごとに構造的なまとまりがある
- 翻訳の正確性・自然さ・文法が評価される

# 出題条件
- 避けるテーマ: {excluded_themes}
- 今回のジャンル候補: 研究紹介、時事、学術、ブログ、レビュー、コラム、図表

# 7ジャンルごとの段落構造テンプレート

①研究紹介（Research summary）:
  P1: 主張/仮説の提示
  P2: 研究方法・手順
  P3: 実験条件/グループ分け
  P4: 結果・発見

②時事（News / whistleblowing）:
  P1: 背景・人物紹介
  P2: 発見・暴露の内容
  P3: 詳細・具体的事実
  P4: 賛否・影響・反応

③学術（Academic exposition）:
  P1: 一般論＋研究による根拠
  P2: 具体的な研究報告
  P3: 効果・適用範囲

④ブログ（Casual blog post）:
  P1: 最近の悩み・課題
  P2: 試した工夫・方法
  P3: 感想・効果＋提案

⑤レビュー（Review）:
  P1: 導入・あらすじ紹介
  P2: 評価ポイント
  P3: テーマ性・印象的シーン
  P4: おすすめ・余韻

⑥コラム（Op-ed / short argument）:
  P1: 問題提起
  P2: 主張＋理由
  P3: 譲歩/反論想定
  P4: 提案・まとめ

⑦図表（Graph / data description）:
  P1: 表/グラフ/数値の提示
  P2: 主な増減・比較
  P3: 理由の推測
  P4: まとめ・結論

# 過去問スタイル参照（※同じ内容での再生成は禁止）
{past_questions_reference}

# 出題要件【必須】

1. **themeの選択**
   - 7ジャンルの固定語（研究紹介/時事/学術/ブログ/レビュー/コラム/図表）から1つ選ぶ
   - excluded_themes に含まれるジャンルは避ける
   - theme は必ず上記7つのいずれかの固定語（括弧付きや細目は追加しない）

2. **japanese_sentences（段落リスト）**
   - 配列で2〜4段落を返す
   - 各段落は2〜3文程度（合計6〜9文が目安）
   - 英訳すると100-120語程度になる和文量
   - 各段落は構造的なまとまりを持つ（上記テンプレートに沿う）
   - 図表ジャンルの場合、表は段落を分けて記述:
     例: P1=表の説明、P2=高校生データ、P3=大学生データ、P4=考察

3. **hints（重要語ヒント）**
   - 5個前後（3〜10個）
   - 本文に出る重要語・専門用語・訳の分岐が大きい語を優先
   - 各ヒントは以下の形式:
     * en: 英語（単語or短い語句）
     * ja: 日本語訳（自然で具体的）
     * kana: カナ発音（任意、学習効果向上のため推奨）
     * pos: 品詞（任意: 名詞/動詞/形容詞/副詞など）
     * usage: 用例（具体的な使用例と日本語訳のセット）
   - 例:
     * {{"en": "surveillance", "ja": "監視", "kana": "サーベイランス", "pos": "名詞", "usage": "government surveillance「政府による監視」"}}
     * {{"en": "detect", "ja": "発見する", "kana": "ディテクト", "pos": "動詞", "usage": "detect health issues early「健康問題を早期に発見する」"}}
     * {{"en": "come to terms with", "ja": "〜と折り合いをつける", "kana": "カム・トゥ・ターム\u30ba・ウィズ", "pos": "動詞句", "usage": "come to terms with stress「ストレスと折り合いをつける」"}}

4. **target_words**
   - {{"min": 100, "max": 120}}（固定）

5. **question_text**
   - null または ""（翻訳問題では英語の問いかけ文は不要）

6. **【🚨🚨🚨 最重要 🚨🚨🚨】テーマの多様性（絶対厳守）**
   - **毎回、完全に異なる具体的なテーマを選ぶこと**
   - **同じキーワード（例：瞑想、運動、睡眠など）を繰り返し使わない**
   - **同じジャンルでも、全く異なる分野の話題を扱うこと**
   
   **例（学術ジャンル）：**
   - ❌ NG: 瞑想の効果、瞑想とストレス → 同じキーワードの繰り返し
   - ✅ OK: 瞑想の効果 → 睡眠の質 → 食事のタイミング → 運動と記憶力 → 日記の効果 → 音楽療法
   
   **例（研究紹介ジャンル）：**
   - 記憶と握力の関係
   - 色が購買行動に与える影響
   - 笑いと免疫力の研究
   - 森林浴の生理的効果
   - ペットと高齢者の健康
   
   **例（時事ジャンル）：**
   - 内部告発者の活動
   - 新技術の社会問題
   - 環境保護の不正暴露
   - データプライバシー侵害
   - 労働環境の問題提起

7. **単語の多様性**
   - 毎回新しい語彙・表現を選択
   - ジャンル特有の専門的・具体的な語彙を優先
   - 同じパターンを使い回さない

8. **出力形式**
   - JSON のみで返す
   - コードブロック（```json）は使わない
   - Markdown 記号は使わない
   - 日本語の引用符「」『』は使わない

# 出力JSON形式

{{
  \"theme\": \"研究紹介\",
  \"question_text\": null,
  \"japanese_sentences\": [
    \"（段落1の日本語2〜3文）\",
    \"（段落2の日本語2〜3文）\",
    \"（段落3の日本語2〜3文）\"
  ],
  \"hints\": [
    {{\"en\": \"...\", \"ja\": \"...\", \"kana\": \"...\", \"pos\": \"...\", \"usage\": \"...\"}},
    {{\"en\": \"...\", \"ja\": \"...\", \"kana\": \"...\", \"pos\": \"...\", \"usage\": \"...\"}}
  ],
  \"target_words\": {{\"min\": 100, \"max\": 120}}
}}

# 注意事項
- 過去問の丸写しは禁止（構造と文体のみ模倣）
- 固有名詞や具体的内容は毎回変更
- ジャンルの構造テンプレートに忠実に従う
- 翻訳難易度は中級（高校〜大学受験レベル）
"""

# 添削用プロンプト（翻訳形式）
CORRECTION_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の添削専門家です。

🚨🚨🚨【JSON出力の絶対ルール】🚨🚨🚨
1. **日本語の引用符「」『』は絶対に使わない** → 代わりに () を使う
2. **例文では半角引用符 " " を使うが、必ずエスケープする** → \\"
3. **JSON内で改行する場合は \\n を使う**
4. **reasonフィールド内では、例文を書く場合は必ず半角スペースで区切る**

❌ NG例（JSON構文エラーになる）:
"reason": "例：This is important.「これは重要です。」"

✅ OK例（正しいJSON）:
"reason": "例：This is important. (これは重要です。)"

# 問題形式
宮崎大学医学部の和文英訳問題（100-120語目安）
- 日本語の段落を英語に翻訳
- 翻訳の正確性・自然さ・文法が評価される

# 原文（日本語）
{question_text}

# 学生の英訳（語数：{word_count}語）
{user_answer}

# 添削方針【重要】

## 評価の重点
1. **原文忠実性**: 意味の欠落・追加・誤解がないか
2. **自然さ**: 不自然な直訳、語法の誤りがないか
3. **文法・語彙**: 時制、受動態、関係詞、前置詞、冠詞など

## よくある誤り（指摘に含める）
- 時制の不一致（過去/現在/完了）
- 受動態の不適切な使用
- 関係詞の誤用・省略
- 抽象名詞・名詞化の未使用
- 比較表現の誤り
- 推量表現の不足
- 接続詞（however, therefore など）の不適切な使用
- 直訳による不自然な表現

## 模範解答(corrected)の要件
- 自然で正確な英訳（100-120語目安）
- 段落構造を維持
- 翻訳として理想的な表現を示す
- 必ず語数をカウントして100-120語に収める

## 指摘ポイント(points)の要件
- **最低5個**の具体的な指摘
- 不足時は「より良い表現」の提案で埋める
- 各pointは以下の形式:
  * reason: 指摘理由（具体的に、例文付き）
  * severity: "major"（重大）/ "minor"（軽微）
  * category: "grammar"（文法）/ "vocabulary"（語彙）/ "style"（文体）/ "accuracy"（正確性）

# 出力JSON形式

{{
  \"corrected\": \"（模範英訳、100-120語）\",
  \"overall_comment\": \"（全体的な講評、翻訳の質・改善点）\",
  \"points\": [
    {{
      \"reason\": \"時制の誤り。過去の出来事なので過去形にすべき。例: \\\"found\\\" → \\\"revealed\\\" (明らかにした)\",
      \"severity\": \"major\",
      \"category\": \"grammar\"
    }},
    {{
      \"reason\": \"直訳的で不自然。名詞化すると自然。例: \\\"when we do something\\\" → \\\"in doing something\\\"\",
      \"severity\": \"minor\",
      \"category\": \"style\"
    }}
  ],
  \"word_count\": {word_count},
  \"constraint_checks\": {{
    \"word_count_ok\": true,
    \"has_clear_structure\": true,
    \"appropriate_vocabulary\": true
  }}
}}

# 注意事項
- 「2理由」「First/Second」などの構成は要求しない（翻訳問題のため）
- 翻訳の正確性と自然さを最優先
- points は必ず5個以上
- JSON構文エラーを起こさないよう、引用符のエスケープを厳守
"""

# モデル解答生成用プロンプト（翻訳形式）
MODEL_ANSWER_PROMPT_MIYAZAKI_TRANSLATION = """
あなたは宮崎大学医学部の和文英訳問題の模範解答作成専門家です。

# 原文（日本語）
{question_text}

# 要件

1. **model_answer**: 自然で正確な英訳（100-120語目安）
   - 段落構造を維持
   - 翻訳として理想的な表現
   - 必ず100-120語に収める
   - 各文を改行（\\n\\n）で区切る

2. **model_answer_explanation**: 一文ずつ詳細に解説（以下のフォーマット厳守）

**【必須フォーマット - kagoshima_100wordsスタイル】**:

```
文法・表現のポイント解説

1文目: （英文全文）
（日本語訳）
重要語A（品詞：意味の詳細説明：使用される文脈）／重要語B（品詞：意味の詳細説明：使用される文脈）で、AとBの使い分けを説明。例：例文1「日本語訳」／例文2「日本語訳」

2文目: （英文全文）
（日本語訳）
重要語C（品詞：意味の詳細説明：使用される文脈）／重要語D（品詞：意味の詳細説明：使用される文脈）で、CとDの使い分けを説明。例：例文1「日本語訳」／例文2「日本語訳」

（以下、全ての文について同様に記述）
```

**解説の詳細ルール**:
- 【絶対厳守】「英文:」「日本語訳:」「解説:」のラベルは書かない
- 【絶対厳守】Markdown記号（#、**、・など）や太字記号を使わない
- 【必須】冒頭に「文法・表現のポイント解説」と書く
- 【必須】各文は「n文目: 英文全文」で始める
- 【必須】次の行に「（日本語訳）」を書く
- 【必須】語彙解説は「単語A（品詞：詳細説明：文脈）／単語B（品詞：詳細説明：文脈）」形式
- 【必須】使い分けの説明と例文2つ以上（日本語訳付き、「／」で区切る）
- 模範解答の全ての文を解説（省略禁止）

# 解説の良い例（kagoshima_100wordsスタイル）

```
文法・表現のポイント解説

1文目: This table shows the annual average temperature changes in a certain city.
（この表は、ある都市の年間平均気温の変化を示している。）
show（動詞：情報やデータを示す・表示する：客観的な提示の文脈）／indicate（動詞：兆候や傾向を示す・指し示す：間接的な示唆の文脈）で、showは直接的に見せること、indicateは間接的に示唆することを指します。例：The graph shows a clear trend.「グラフは明確な傾向を示しています。」／This indicates a problem.「これは問題を示唆しています。」

2文目: Looking at the high school student data, we can see a sharp rise in temperature from spring to summer.
（高校生データを見ると、春から夏にかけて急激に気温が上昇していることがわかる。）
sharp（形容詞：急激な・鋭い：突然の大きな変化の文脈）／gradual（形容詞：段階的な・徐々の：ゆっくりとした変化の文脈）で、sharpは急激で明確な変化、gradualは緩やかな変化を示します。例：There was a sharp increase.「急激な増加がありました。」／The change was gradual.「変化は段階的でした。」

3文目: On the other hand, the university student data reveals a more pronounced temperature drop from autumn to winter.
（一方、大学生データでは、秋から冬にかけての気温低下がより顕著に現れている。）
pronounced（形容詞：顕著な・はっきりした：目立つ特徴の文脈）／noticeable（形容詞：目立つ・気づきやすい：認識できる程度の文脈）で、pronouncedはより強く際立っていること、noticeableは気づく程度であることを指します。例：There was a pronounced difference.「顕著な違いがありました。」／The change was noticeable.「変化は目立ちました。」

4文目: These data suggest that adjusting lifestyle habits according to seasonal temperature changes is important.
（これらのデータは、季節ごとの気温変化に応じた生活習慣の調整が重要であることを示唆している。）
suggest（動詞：提案する・示唆する：間接的に意味を伝える文脈）／prove（動詞：証明する・立証する：確実な根拠を示す文脈）で、suggestは可能性や推測を示し、proveは確実な証拠による証明を指します。例：The data suggest a correlation.「データは相関関係を示唆しています。」／This proves the theory.「これは理論を証明します。」
```

# 出力JSON形式

{{
  \"model_answer\": \"（模範英訳、100-120語、各文を\\n\\nで区切る）\",
  \"model_answer_explanation\": \"文法・表現のポイント解説\\n\\n1文目: ...\\n（...）\\n語彙解説...\\n\\n2文目: ...\\n（...）\\n語彙解説...\\n\\n（以下、全ての文について同様）\"
}}

# 注意事項
- JSON のみで返す
- コードブロック（```）禁止
- 「英文:」「日本語訳:」「解説:」ラベル禁止
- Markdown 記号（#、**など）禁止
- 日本語の引用符「」『』は使わない（半角ダブルクォートのみ）
- 引用符のエスケープを厳守
- 改行は \\n を使用
- 模範解答の全文を解説（省略禁止）
"""
